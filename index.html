<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <script src="https://unpkg.com/knockout@3.5.1/build/output/knockout-latest.js"></script>
  <script src="https://unpkg.com/survey-knockout@1.9.96/survey.ko.min.js"></script>
  <link
    href="https://unpkg.com/survey-core@1.9.96/modern.min.css"
    type="text/css"
    rel="stylesheet"
  />
  <style>
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      overflow: hidden;
    }

    .profiler-results {
      display: none;
    }

    .assessment-container {
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    #surveyContainer {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      min-width: 330px;
    }

    .toolbar {
      display: flex;
      justify-content: flex-end;
      flex-shrink: 0;
      flex-direction: row;
    }

    .toolbar:empty {
      display: none;
    }

    .toolbar.bottom-toolbar {
      padding: 10px 0;
    }

    .toolbar .toolbar-button {
      -webkit-box-align: center;
      align-items: center;
      border-radius: 0.25rem;
      --tw-text-opacity: 1;
      color: rgba(67, 56, 202, var(--tw-text-opacity));
      --tw-bg-opacity: 1;
      background-color: rgba(224, 231, 255, var(--tw-bg-opacity));
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      line-height: 1rem;
      font-weight: 500;
      margin: 5px;
      border: none !important;
    }

    .toolbar .toolbar-button:hover {
      background-color: rgba(199, 210, 254, var(--tw-bg-opacity));
    }

    .toolbar .toolbar-button:disabled {
      background-color: rgba(224, 231, 255, var(--tw-bg-opacity));
      color: rgba(80, 80, 80, var(--tw-text-opacity));
    }

    .disabled-nav-button input {
      background-color: rgba(80, 80, 80, 0.5) !important;
      cursor: default;
    }

    .sv-tagbox.sv-tagbox--empty .question-hint,
    .sv-tagbox.sv-tagbox--empty .sv-tagbox__filter-string-input {
      width: 100%;
    }

    .sv-tagbox__item {
      height: auto;
    }

    .sv-tagbox__value.sv-dropdown__value {
      overflow-y: auto;
    }

    .sv-tagbox.sv-tagbox .question-hint-suffix,
    .sv-dropdown__filter-string-input {
      height: 100% !important;
      --tw-ring-color: transparent !important;
    }

  </style>
</head>
<body>
  <p>Test chat page</p>

  <div class="assessment-container">
      <div class="toolbar top-toolbar"></div>
      <div id="surveyContainer">
        <div id="surveyContent"></div>
      </div>
      <div class="toolbar bottom-toolbar"></div>
    </div>
    <script type="text/javascript">
      (function () {
        var field = {
    "command": "submit",
    "location": "messenger",
    "action": {
        "type": "submit"
    },
    "values": {
        "show_save_btn": false,
        "sender_id": 2,
        "template": {
            "id": 3,
            "title": "Intake",
            "active": true,
            "prompt_for_password": false,
            "created_at": "2023-09-13T20:18:00.709Z",
            "updated_at": "2023-09-13T20:18:00.709Z",
            "version": 10,
            "content": {
                "pages": [
                    {
                        "name": "page2",
                        "elements": [
                            {
                                "name": "Seeing Someone",
                                "type": "radiogroup",
                                "title": "Are you currently seeing a physician",
                                "choices": [
                                    {
                                        "text": "Yes",
                                        "value": "item1"
                                    },
                                    {
                                        "text": "No",
                                        "value": "item2"
                                    },
                                    {
                                        "text": "maybe",
                                        "value": "item3"
                                    }
                                ],
                                "isRequired": true
                            },
                            {
                                "name": "What Type",
                                "type": "dropdown",
                                "title": "What type of physician are you seeing? ",
                                "choices": [
                                    {
                                        "text": "General Practitioner ",
                                        "value": "item1"
                                    },
                                    {
                                        "text": "Specialist",
                                        "value": "item2"
                                    }
                                ],
                                "visibleIf": "{Seeing Someone} = \"item1\"",
                                "isRequired": true
                            },
                            {
                                "name": "When was the last time you saw a provider?",
                                "type": "datepicker",
                                "visibleIf": "{Seeing Someone} = \"item2\""
                            }
                        ]
                    },
                    {
                        "name": "page3",
                        "elements": [
                            {
                                "name": "Medication",
                                "type": "radiogroup",
                                "title": "Are you currently on any medication? ",
                                "choices": [
                                    {
                                        "text": "Yes",
                                        "value": "item1"
                                    },
                                    {
                                        "text": "No",
                                        "value": "item2"
                                    }
                                ]
                            },
                            {
                                "name": "question2",
                                "type": "comment",
                                "title": "Please list out the medication you are on",
                                "width": "350",
                                "visibleIf": "{Medication} = \"item1\"",
                                "isRequired": true
                            },
                            {
                                "name": "All that Apply",
                                "type": "checkbox",
                                "title": "Please select all that apply ",
                                "choices": [
                                    {
                                        "text": "I have a chronic medical condition",
                                        "value": "item1"
                                    },
                                    {
                                        "text": "I am diagnosed with a psychiatric/mental condition",
                                        "value": "item2"
                                    },
                                    {
                                        "text": "I have an acute medical condition",
                                        "value": "item3"
                                    },
                                    {
                                        "text": "I do not have an acute or a chronic medical condition",
                                        "value": "item4"
                                    }
                                ]
                            },
                            {
                                "name": "question3",
                                "type": "comment",
                                "title": "Please list out the condition(s)",
                                "visibleIf": "{All that Apply} <> [\"item4\"]",
                                "isRequired": true
                            },
                            {
                                "name": "question4",
                                "type": "bootstrapslider",
                                "title": "On a scale of 1 to 10 (1 being not comfortable at all 10 being very comfortable), how comfortable are you with injection needles? ",
                                "rangeMax": 10
                            }
                        ]
                    },
                    {
                        "name": "page3.5",
                        "elements": [
                            {
                                "name": "Coverage",
                                "type": "radiogroup",
                                "title": "Do you have insurance coverage? ",
                                "choices": [
                                    {
                                        "text": "Yes",
                                        "value": "item1"
                                    },
                                    {
                                        "text": "No",
                                        "value": "item2"
                                    }
                                ]
                            },
                            {
                                "name": "question6",
                                "type": "text",
                                "title": "What is the percentage of coverage? ",
                                "enableIf": "{Coverage} = \"item1\"",
                                "isRequired": true,
                                "validators": [
                                    {
                                        "type": "numeric",
                                        "maxValue": 100,
                                        "minValue": 1
                                    }
                                ],
                                "requiredErrorText": "Please enter a value above 1%"
                            },
                            {
                                "html": "<body> \nBased on the percentage you put in, you will be responsible for the difference in cost. \n</body>",
                                "name": "question5",
                                "type": "html",
                                "visibleIf": "{question6} <= 99.9"
                            }
                        ]
                    }
                ],
                "title": "Intake Assessment Form One",
                "introText": "Please fill out the intake assessment form.",
                "introTitle": "Welcome",
                "completedText": "You rocked it!!",
                "completedTitle": "Thank you!",
                "firstPageIsStarted": true
            },
            "data_mapping": [],
            "questions_on_page_mode": "single-page"
        },
        "content": {},
        "language": "en",
        "message_key": "HERaVq7SXcDrsTsS6rXqaDp6",
        "started_at": "2023-09-13T20:19:07.306+00:00"
    }
}
        var themeColor = "#121212";
        var values = field.values;
        var buttons = values.buttons || [];
        var lang = values.language || "en";

        // override the default theme colors
        const defaultThemeColors = Survey
                                    .StylesManager
                                    .ThemeColors.modern;

        defaultThemeColors['$main-color'] = `${themeColor}`;
        defaultThemeColors['$add-button-color'] = `${themeColor}`;
        defaultThemeColors['$primary'] = `${themeColor}`;

        // Add 33 at the end of the hex to add 0.2 opacity ie.RRGGBBAA hex notation
        defaultThemeColors['$answer-background-color'] = `${themeColor}33`;
        defaultThemeColors['$primary-light'] = `${themeColor}33`;

        const customCss = {
          "question": {
            "hint": "question-hint",
            "hintSuffixWrapper": "question-hint-suffix"
          }
        };

        // initialize survey
        Survey.StylesManager.applyTheme('modern');
        var survey = new Survey.Model(values.template.content);

        // load values
        survey.data = values.content;
        survey.locale = lang;
        survey.css = customCss;

        if (values.readonly) {
          survey.mode = 'display';
        } else {
          survey.onComplete.add(() => sendMessage(survey.data, 'submit'));

          // add aditional nav buttons
          buttons.forEach(function (button, index) {
            if (button.location) {
              return;
            }

            var btn = createNavigationButton('button ' + index, button, function () {
              sendMessage(survey.data, button.command);
            });
            survey.addNavigationItem(btn);
          });
        }

        // add toolbar buttons
        buttons.forEach(function (button, index) {
          if (!button.location) {
            return;
          } 

          var btn = createToolbarButton('button ' + index, button, function () {
            sendMessage(survey.data, button.command);
          });
          addToolbarButton(btn, button.location);
        });

        function sendMessage(content, command) {
          window.parent.postMessage(
            {
              chaskiqMessage: true,
              type: 'Assessments',
              field: Object.assign({}, field, {
                command: command,
                values: Object.assign({}, field.values, { content: content }),
              }),
            },
            '*'
          );
        }

        function createToolbarButton(id, button, handler) {
          var btn = document.createElement('button');
          btn.id = id;
          btn.className = 'transition duration-150 ease-in-out toolbar-button';
          btn.addEventListener('click', handler);
          btn.innerText = button.title;
          btn.disabled = typeof button.enabled === 'undefined' ? false : !button.enabled;
          return btn;
        }

        function createNavigationButton(id, button, handler) {
          var enabled = typeof button.enabled === 'undefined' ? true : button.enabled;
          var btn = {
            id: id,
            title: button.title,
            action: enabled ? handler : undefined,
            css: enabled ? undefined : 'disabled-nav-button',
          };
          return btn;
        }

        function addToolbarButton(btn, location) {
          document.querySelector(`.${location}`).appendChild(btn);
        }

        survey.render("surveyContent");
      })();
    </script>


  
      <!-- sbx digital front door chat integration -->
<!--   <script>
        (function(d,t) {
          var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
          g.src="https://app.ca.one-stop-talk.sbx.gcp.trchq.com/embed.js"
          s.parentNode.insertBefore(g,s);
          g.onload=function(){
            new window.VirtualCareMessengerEncrypted({
//               domain: 'https://test.ca.one-stop-talk.sbx.gcp.trchq.com',
//               ws:  'wss://test.ca.one-stop-talk.sbx.gcp.trchq.com/cable',
//               app_id: "XnA6d2mEejaov78UETAzM5uj",
              domain: 'https://app.ca.one-stop-talk.sbx.gcp.trchq.com',
              ws:  'wss://app.ca.one-stop-talk.sbx.gcp.trchq.com/cable',
              app_id: "A65a4LPG6rXHg7rz7EdBjxNg",
              lang: "en",
              mode: "fullscreen"
            })
          }
        })(document,"script");
      </script> -->
  
      <!-- staging chat integration -->
<!--       <script>
        (function(d,t) {
          var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
          g.src="https://test.ca.digital-front-door.stg.gcp.trchq.com/embed.js"
          s.parentNode.insertBefore(g,s);
          g.onload=function(){
            new window.VirtualCareMessengerEncrypted({
              domain: 'https://test.ca.digital-front-door.stg.gcp.trchq.com',
              ws:  'wss://test.ca.digital-front-door.stg.gcp.trchq.com/cable',
              app_id: "rxwFha2rt1kkBH64f2JR9MPi",
              lang: "en",
              // mode: "fullscreen"
            })
          }
        })(document,"script");
      </script> -->

      <!--    dev chat integration    -->
<!--       <script>
        (function(d,t) {
          var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
          g.src="https://test.ca.digital-front-door.dev.gcp.trchq.com/embed.js"
          s.parentNode.insertBefore(g,s);
          g.onload=function(){
            new window.VirtualCareMessengerEncrypted({
              domain: 'https://test.ca.digital-front-door.dev.gcp.trchq.com',
              ws:  'wss://test.ca.digital-front-door.dev.gcp.trchq.com/cable',
              app_id: "XhaeaVJPLz73QUMP5LzFrTt9" || "9V6WeTk1QKUigsp1GzGoAzMJ",
              lang: "en",
              // mode: "fullscreen"
            })
          }
        })(document,"script");
      </script> -->
  
      <!-- local chat integration -->
      <script>
        (function (d, t) {
          var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
          g.src = "https://188a-149-248-176-226.ngrok-free.app/embed.js"
          s.parentNode.insertBefore(g, s);
          g.onload=function(){
            new window.VirtualCareMessengerEncrypted({
              domain: 'https://188a-149-248-176-226.ngrok-free.app',
              ws:  'wss://188a-149-248-176-226.ngrok-free.app/cable',
              app_id: "JXK85EBf9JEgJ2YyZbK85QK9",
              lang: "en",
              mode: "fullscreen"
            })
          }
        })(document, "script");
      </script>

<!--  Menf local      -->
<!--         <script>
        (function (d, t) {
          var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
          g.src = "https://46ad-76-9-211-50.ngrok-free.app/embed.js"
          s.parentNode.insertBefore(g, s);
          g.onload=function(){
            new window.VirtualCareMessengerEncrypted({
              domain: 'https://46ad-76-9-211-50.ngrok-free.app',
              ws:  'wss://46ad-76-9-211-50.ngrok-free.app/cable',
              app_id: "4k8SaB7ehqs2V7AX6E8gav8U", // "JXK85EBf9JEgJ2YyZbK85QK9",
              lang: "en",
              mode: "fullscreen",
              data: {
                "email": "bob@dfd.com",
                "identifier_key": "29de1f5b89080c03ead45ebce69d164e569af3a587770ee0fa05d9be9cfccd06",
                "properties": {
                  "name": "bob"
                }
              }
            })
          }
        })(document, "script");
      </script> -->
  
<!--   <script>
  window['_fs_host'] = 'fullstory.com';
  window['_fs_script'] = 'edge.fullstory.com/s/fs.js';
  window['_fs_org'] = 'o-1KE8B7-na1';
  window['_fs_namespace'] = 'FS';
  (function(m,n,e,t,l,o,g,y){
      if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
      g=m[e]=function(a,b,s){g.q?g.q.push([a,b,s]):g._api(a,b,s);};g.q=[];
      o=n.createElement(t);o.async=1;o.crossOrigin='anonymous';o.src='https://'+_fs_script;
      y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
      g.identify=function(i,v,s){g(l,{uid:i},s);if(v)g(l,v,s)};g.setUserVars=function(v,s){g(l,v,s)};g.event=function(i,v,s){g('event',{n:i,p:v},s)};
      g.anonymize=function(){g.identify(!!0)};
      g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
      g.log = function(a,b){g("log",[a,b])};
      g.consent=function(a){g("consent",!arguments.length||a)};
      g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
      g.clearUserCookie=function(){};
      g.setVars=function(n, p){g('setVars',[n,p]);};
      g._w={};y='XMLHttpRequest';g._w[y]=m[y];y='fetch';g._w[y]=m[y];
      if(m[y])m[y]=function(){return g._w[y].apply(this,arguments)};
      g._v="1.3.0";
  })(window,document,window['_fs_namespace'],'script','user');
  </script> -->
</body>
</html>
